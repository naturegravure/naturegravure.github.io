<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hommage</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">

    <!-- ===== HEADER / D√âFUNT ===== -->
    <header>
      <h1>Jean Dupont</h1>
      <div class="dates">12/03/1950 - 05/12/2025</div>
    </header>

    <!-- ===== PORTRAIT ===== -->
    <div class="portrait">
      <img src="portrait.jpg" alt="Portrait du d√©funt">
    </div>

    <!-- ===== TEXTE D‚ÄôHOMMAGE ===== -->
    <div class="texte">
      <p>Nous nous souvenons avec tendresse de Jean, un √™tre cher qui restera dans nos c≈ìurs √† jamais.</p>
    </div>

    <!-- ===== INFORMATIONS SUR LA C√âR√âMONIE ===== -->
    <div class="infos">
      <h2>C√©r√©monie</h2>
      <p>Date : 10 d√©cembre 2025</p>
      <p>Lieu : √âglise Saint-Pierre, Coincin</p>
    </div>

    <!-- ===== BOUCIES ===== -->
    <div class="bougie-section">
      <h2>Allumez une bougie en sa m√©moire</h2>
      <div class="candle-wrapper" id="candleWrapper"></div>
      <div class="counter" id="counter">0 bougie(s) allum√©e(s)</div>
    </div>

    <!-- ===== MESSAGES ===== -->
    <div class="messages">
      <h2>Messages</h2>
      <div id="msgList"><em>Aucun message pour l'instant.</em></div>

      <form id="msgForm">
        <input type="text" id="name" placeholder="Votre nom" required>
        <textarea id="text" placeholder="Votre message" required></textarea>
        <button type="submit">Envoyer</button>
      </form>
    </div>

    <footer>
      &copy; 2025 Hommage
    </footer>
  </div>

  <script>
    // ===== CONFIG =====
    const BASE_URL = "https://script.google.com/macros/s/TON_URL/exec"; // Mets ici ton URL Apps Script
    const NUM_BOUCIES = 5;

    // ===== BOUCIES =====
    const candleWrapper = document.getElementById('candleWrapper');
    const counterEl = document.getElementById('counter');
    let bougiesAllumees = 0;

    function updateCounter() {
      counterEl.textContent = bougiesAllumees + " bougie(s) allum√©e(s)";
    }

    for (let i = 0; i < NUM_BOUCIES; i++) {
      const container = document.createElement('div');
      container.className = 'candle-container';
      const btn = document.createElement('button');
      btn.className = 'candle-btn';
      btn.textContent = 'üïØÔ∏è';
      const flame = document.createElement('div');
      flame.className = 'flame';
      container.appendChild(btn);
      container.appendChild(flame);
      candleWrapper.appendChild(container);

      btn.addEventListener('click', () => {
        btn.classList.toggle('lit');
        flame.style.opacity = btn.classList.contains('lit') ? 1 : 0;
        bougiesAllumees = document.querySelectorAll('.candle-btn.lit').length;
        updateCounter();
      });
    }

    // ===== MESSAGES =====
    function loadMessages(){
      fetch(BASE_URL+'?action=getMessages')
      .then(r=>r.json())
      .then(d=>{
        const cont=document.getElementById('msgList');
        if(d.messages && d.messages.length){
          cont.innerHTML=d.messages.map(m=>`<div class="message"><strong>${m.name}</strong> <span class="ts">(${m.timestamp})</span><br>${m.text}</div>`).join('');
        } else cont.innerHTML="<em>Aucun message pour l'instant.</em>";
      }).catch(console.error);
    }

    document.getElementById('msgForm').addEventListener('submit', function(e){
      e.preventDefault();
      const name = document.getElementById('name').value.trim();
      const text = document.getElementById('text').value.trim();
      if(!name || !text) return;
      fetch(BASE_URL+'?action=addMessage&name='+encodeURIComponent(name)+'&text='+encodeURIComponent(text))
        .then(r=>r.json())
        .then(()=>{
          loadMessages();
          document.getElementById('msgForm').reset();
        }).catch(console.error);
    });

    updateCounter();
    loadMessages();
  </script>
</body>
</html>
